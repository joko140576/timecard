<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Time Card Pegawai PT SSI Jatiwarna</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

<style>
body { background:#f6f8fa; padding-bottom:80px }
.card { border-radius:15px; box-shadow:0 4px 10px rgba(0,0,0,.1) }
.guide-box { display:none; background:#fff8e1; border-left:5px solid #ffc107; border-radius:10px; padding:15px }
#taskTable thead th { background:#0d6efd; color:#fff }
#loadingOverlay {
    position:fixed; inset:0; background:rgba(255,255,255,.85);
    display:none; align-items:center; justify-content:center; z-index:9999
}
</style>
</head>

<body class="p-3">

<!-- ================= MODAL DONASI DI OFF ================= 
<div class="modal fade" id="donasiModal" tabindex="-1" data-bs-backdrop="static">
<div class="modal-dialog modal-dialog-centered">
<div class="modal-content rounded-4 text-center p-4">
<i class="bi bi-heart-fill text-danger fs-1 mb-3"></i>
<h4 class="fw-bold">Ayo Berdonasi</h4>
<p>Bantu saudara kita korban <b>bencana Sumatera</b></p>
<div class="alert alert-warning fw-semibold">
Wisnu Renaldy<br>BNI <b>1791 3414 08</b>
</div>
<button type="button" class="btn btn-primary" data-bs-dismiss="modal">
Masuk Timecard
</button>
</div>
</div>
</div>  -->

<!-- ================= MODAL SUKSES ================= -->
<div class="modal fade" id="successModal" tabindex="-1">
<div class="modal-dialog modal-dialog-centered">
<div class="modal-content rounded-4 text-center p-4">
<i class="bi bi-check-circle-fill text-success fs-1 mb-3"></i>
<h4 class="fw-bold">Berhasil!</h4>
<p>Data Time Card berhasil dikirim.</p>
<button type="button" class="btn btn-success" data-bs-dismiss="modal">OK</button>
</div>
</div>
</div>

<div class="container">
<div class="card p-4">
<h3 class="text-center text-primary fw-bold mb-3">
Time Card Pegawai PT SSI Jatiwarna
</h3>

<div class="text-center mb-3">
<button type="button" id="btnGuide" class="btn btn-warning">ðŸ“˜ Cara Mengisi</button>
</div>

<div id="guideBox" class="guide-box">
<ol>
<li>Isi data pegawai</li>
<li>Klik kolom tugas untuk input</li>
<li>Submit jika selesai</li>
</ol>
</div>

<form id="timeCardForm">

<div class="row g-3">
<div class="col-md-4">
<label>Tanggal</label>
<input type="date" id="tanggal" class="form-control" required>
</div>
<div class="col-md-4">
<label>Nama ( pengisian nama konsisten jangan berubah ubah ! )</label>
<input type="text" id="nama" class="form-control" required>
</div>
<div class="col-md-4">
<label>NPP</label>
<input type="text" id="npp" class="form-control" required>
</div>

<div class="col-md-6">
<label>Divisi</label>
<select id="divisi" class="form-select" required>
<option value="">-- Pilih --</option>
<option>CSI</option>
<option>FRM</option>
<option>HCC</option>
<option>INA</option>
<option>MBS</option>
<option>OPR-1</option>
<option>OPR-2</option>
<option>OPS</option>
<option>PLM</option>
<option>SBD</option>
</select>
</div>

<div class="col-md-6">
<label>Jabatan</label>
<select id="jabatan" class="form-select" required>
<option value="">-- Pilih --</option>
<option>Staf</option>
<option>Manager</option>
<option>Senior Manager</option>
<option>General Manager</option>
</select>
</div>
</div>

<hr>

<table class="table table-bordered text-center" id="taskTable">
<thead>
<tr>
<th>Jenis</th><th>Uraian</th><th>Jam</th><th>Menit</th><th>Aksi</th>
</tr>
</thead>
<tbody>
<tr>
<td><input class="form-control jenis" readonly></td>
<td><input class="form-control uraian" readonly></td>
<td><input class="form-control jam" readonly></td>
<td><input class="form-control waktu" readonly></td>
<td><button type="button" class="btn btn-danger btn-sm" onclick="hapusBaris(this)">âœ–</button></td>
</tr>
</tbody>
</table>

<div class="d-flex justify-content-between">
<button type="button" class="btn btn-success" onclick="tambahBaris()">+ Baris</button>
<h6>Total: <span id="totalWaktu">0</span> menit</h6>
</div>

<div class="text-center mt-4">
<button type="submit" class="btn btn-primary btn-lg">Submit</button>
</div>
<div class="text-center mt-4">
<a href="tabel/tampil.html" target="_blank" class="btn btn-secondary w-100 mt-3">Buka Database</a>
</div>
</form>
</div>
</div>

<!-- ================= MODAL INPUT ================= -->
<div class="modal fade" id="inputModal" tabindex="-1">
<div class="modal-dialog">
<div class="modal-content">
<div class="modal-header bg-primary text-white">
<h5 id="modalLabel">Input</h5>
<button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
</div>
<div class="modal-body">
<input id="modalInput" class="form-control">
</div>
<div class="modal-footer">
<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
<button type="button" class="btn btn-primary" id="btnSaveModal">Simpan</button>
</div>
</div>
</div>
</div>

<div id="loadingOverlay">
<div class="text-center">
<div class="spinner-border text-primary"></div>
<p>Mengirim data...</p>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbz97ZT9VVJ0n609906B_Ep3qRiI36JYigMnrRvsDP_QUwFWEbZKG3E4qIzv2OZ43ApMoA/exec";

/* Donasi muncul 1x */
document.addEventListener("DOMContentLoaded",()=>{
if(!sessionStorage.getItem("donasi")){
new bootstrap.Modal(donasiModal).show();
sessionStorage.setItem("donasi","yes");
}
});

/* Guide */
btnGuide.onclick=()=>guideBox.style.display=
guideBox.style.display==="block"?"none":"block";

/* Modal input */
let currentInput=null;
document.addEventListener("click",e=>{
if(e.target.readOnly){
currentInput=e.target;
modalInput.value=currentInput.value;
new bootstrap.Modal(inputModal).show();
}
});

btnSaveModal.onclick=()=>{
currentInput.value=modalInput.value;
hitungTotal();
bootstrap.Modal.getInstance(inputModal).hide();
};

/* Table */
function tambahBaris(){
taskTable.querySelector("tbody").insertAdjacentHTML("beforeend",`
<tr>
<td><input class="form-control jenis" readonly></td>
<td><input class="form-control uraian" readonly></td>
<td><input class="form-control jam" readonly></td>
<td><input class="form-control waktu" readonly></td>
<td><button type="button" class="btn btn-danger btn-sm" onclick="hapusBaris(this)">âœ–</button></td>
</tr>`);
}

function hapusBaris(btn){
btn.closest("tr").remove(); hitungTotal();
}

function hitungTotal(){
let total=0;
document.querySelectorAll(".jam").forEach((j,i)=>{
total+= (Number(j.value)||0)*60 + (Number(document.querySelectorAll(".waktu")[i].value)||0);
});
totalWaktu.innerText=total;
}

/* SUBMIT FINAL */
timeCardForm.addEventListener("submit",e=>{
e.preventDefault();
loadingOverlay.style.display="flex";

const tasks=[...taskTable.tBodies[0].rows].map(r=>({
jenis:r.querySelector(".jenis").value,
uraian:r.querySelector(".uraian").value,
jam:r.querySelector(".jam").value,
waktu:r.querySelector(".waktu").value
}));

fetch(scriptURL,{
method:"POST",
headers:{ "Content-Type":"text/plain;charset=utf-8" },
body:JSON.stringify({
tanggal:tanggal.value,
nama:nama.value,
npp:npp.value,
divisi:divisi.value,
jabatan:jabatan.value,
tasks
})
})
.then(r=>r.text())
.then(()=>{
loadingOverlay.style.display="none";
new bootstrap.Modal(successModal).show();
timeCardForm.reset(); totalWaktu.innerText="0";
})
.catch(err=>{
loadingOverlay.style.display="none";
alert("Gagal kirim: "+err);
});
});
</script>

</body>
</html>

        


 
